<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì‚¬íšŒë³µì§€ì‚¬ ì‚¬ì—…ê´€ë¦¬ ì‹œìŠ¤í…œ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Malgun Gothic', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            font-size: 12px;
        }

        .container {
            max-width: 1800px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }

        .header h1 {
            font-size: 1.8em;
            margin-bottom: 10px;
        }

        .tabs {
            display: flex;
            background: #f5f5f5;
            border-bottom: 2px solid #ddd;
        }

        .tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            background: #f5f5f5;
            border: none;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .tab.active {
            background: white;
            color: #4facfe;
            border-bottom: 2px solid #4facfe;
        }

        .tab:hover {
            background: #e8f4fd;
        }

        .tab-content {
            display: none;
            padding: 20px;
        }

        .tab-content.active {
            display: block;
        }

        .main-layout {
            display: flex;
            gap: 20px;
            min-height: 800px;
        }

        .input-section {
            flex: 1;
            background: #f9f9f9;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #e0e0e0;
        }

        .summary-section {
            flex: 1;
            background: #f9f9f9;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #e0e0e0;
        }

        .section-title {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 15px;
            color: white;
            text-align: center;
            background: #4facfe;
            padding: 10px;
            border-radius: 5px;
        }

        .form-section {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            background: white;
        }

        .form-section-title {
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 10px;
            color: #4facfe;
        }

        .input-form {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #ddd;
        }

        .form-row {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
        }

        .form-group {
            flex: 1;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 12px;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #4facfe;
            box-shadow: 0 0 5px rgba(79, 172, 254, 0.3);
        }

        .btn {
            background: linear-gradient(45deg, #4facfe, #00f2fe);
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(79, 172, 254, 0.4);
        }

        .btn-edit {
            background: #ffa500;
            padding: 5px 10px;
            font-size: 11px;
        }

        .btn-edit:hover {
            background: #e69500;
        }

        .delete-btn {
            background: #ff4757;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 11px;
        }

        .delete-btn:hover {
            background: #ff3742;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            font-size: 11px;
        }

        .data-table th,
        .data-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
        }

        .data-table th {
            background: #4facfe;
            color: white;
            font-weight: bold;
        }

        .data-table tr:nth-child(even) {
            background: #f9f9f9;
        }

        .data-table tr:hover {
            background: #e8f4fd;
        }

        .summary-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
            font-size: 11px;
        }

        .summary-table th,
        .summary-table td {
            border: 1px solid #ddd;
            padding: 6px;
            text-align: center;
            color: #000;
        }

        .summary-table th {
            background: #f0f0f0;
            font-weight: bold;
        }

        .summary-table .program-header {
            background: #4facfe;
            color: white;
            font-weight: bold;
        }

        .summary-table .total-row {
            background: #ffe6e6;
            font-weight: bold;
        }

        .log-section {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid #e0e0e0;
        }

        .log-section .section-title {
            background: #764ba2;
        }

        .log-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            font-size: 11px;
        }

        .log-table th,
        .log-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
        }

        .log-table th {
            background: #764ba2;
            color: white;
            font-weight: bold;
        }

        .log-table tr:nth-child(even) {
            background: #f9f9f9;
        }

        .log-table tr:hover {
            background: #f3e8fd;
        }

        .participant-group {
            display: flex;
            gap: 10px;
        }

        .participant-group .form-group {
            flex: 1;
        }

        .save-status {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #2ecc71;
            color: white;
            padding: 10px 15px;
            border-radius: 5px;
            font-size: 12px;
            font-weight: bold;
            display: none;
            z-index: 1000;
        }

        .btn-save {
            background: #2ecc71;
            margin-left: 10px;
        }

        .btn-save:hover {
            background: #27ae60;
        }

        @media (max-width: 1200px) {
            .main-layout {
                flex-direction: column;
            }
        }
    </style>
</head>

<body>
    <div class="save-status" id="saveStatus">ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!</div>

    <div class="container">
        <div class="header">
            <h1>ì‚¬íšŒë³µì§€ì‚¬ ì‚¬ì—…ê´€ë¦¬ ì‹œìŠ¤í…œ</h1>
            <p>2025ë…„ ì‚¬ì—… ìš´ì˜ ì‹¤ì  ë° ì˜ˆì‚° ê´€ë¦¬</p>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="app.switchTab('performance', this)">ì‚¬ì—… ìš´ì˜ ì‹¤ì </button>
            <button class="tab" onclick="app.switchTab('budget', this)">ì‚¬ì—… ì˜ˆì‚° ì‚¬ìš© ë‚´ì—­</button>
            <button class="tab" onclick="app.switchTab('settings', this)">ì„¤ì •</button>
        </div>

        <div id="performance" class="tab-content active">
            <div class="main-layout">
                <div class="input-section">
                    <div class="section-title">ì‚¬ì—… ì‹¤ì  ì…ë ¥</div>
                    <div class="input-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label>ì›”</label>
                                <select id="month">
                                    <option value="">ì„ íƒ</option>
                                    <option value="1">1ì›”</option>
                                    <option value="2">2ì›”</option>
                                    <option value="3">3ì›”</option>
                                    <option value="4">4ì›”</option>
                                    <option value="5">5ì›”</option>
                                    <option value="6">6ì›”</option>
                                    <option value="7">7ì›”</option>
                                    <option value="8">8ì›”</option>
                                    <option value="9">9ì›”</option>
                                    <option value="10">10ì›”</option>
                                    <option value="11">11ì›”</option>
                                    <option value="12">12ì›”</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>ì¼</label>
                                <input type="number" id="day" min="1" max="31">
                            </div>
                            <div class="form-group">
                                <label>ì‚¬ì—…ëª…</label>
                                <select id="program" onchange="app.updateActivities()">
                                    <option value="">ì„ íƒ</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>ì„¸ë¶€í™œë™</label>
                                <select id="activity">
                                    <option value="">ì„ íƒ</option>
                                </select>
                            </div>
                            <div class="participant-group">
                                <div class="form-group">
                                    <label>ìˆ˜ê¸‰ì</label>
                                    <input type="number" id="recipientCount" min="0" value="0">
                                </div>
                                <div class="form-group">
                                    <label>ì¼ë°˜</label>
                                    <input type="number" id="generalCount" min="0" value="0">
                                </div>
                            </div>
                        </div>
                        <div class="form-row">
                            <button class="btn" onclick="app.addPerformanceData()">ì¶”ê°€</button>
                        </div>
                    </div>
                </div>

                <div class="summary-section">
                    <div class="section-title">ì‚¬ì—…ë³„ ì‹¤ì  í˜„í™©</div>
                    <div id="performanceSummary"></div>

                    <div class="section-title" style="margin-top: 30px;">ì›”ë³„ ì‹¤ì  í˜„í™©</div>
                    <div id="monthlyPerformance"></div>

                    <div class="section-title" style="margin-top: 30px;">ë¶„ê¸°ë³„ ì‹¤ì  í˜„í™©</div>
                    <div id="quarterlyPerformance"></div>
                </div>
            </div>

            <div class="log-section">
                <div class="section-title">ì…ë ¥ëœ ì‚¬ì—… ì‹¤ì  ë¡œê·¸</div>
                <table class="log-table">
                    <thead>
                        <tr>
                            <th>ì›”</th>
                            <th>ì¼</th>
                            <th>ì‚¬ì—…ëª…</th>
                            <th>ì„¸ë¶€í™œë™</th>
                            <th>ìˆ˜ê¸‰ì</th>
                            <th>ì¼ë°˜</th>
                            <th>í•©ê³„</th>
                            <th>ìˆ˜ì •</th>
                            <th>ì‚­ì œ</th>
                        </tr>
                    </thead>
                    <tbody id="performanceLog">
                    </tbody>
                </table>
            </div>
        </div>

        <div id="budget" class="tab-content">
            <div class="main-layout">
                <div class="input-section">
                    <div class="section-title">ì˜ˆì‚° ì‚¬ìš© ë‚´ì—­ ì…ë ¥</div>
                    <div class="input-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label>ì›”</label>
                                <select id="budgetMonth">
                                    <option value="">ì„ íƒ</option>
                                    <option value="1">1ì›”</option>
                                    <option value="2">2ì›”</option>
                                    <option value="3">3ì›”</option>
                                    <option value="4">4ì›”</option>
                                    <option value="5">5ì›”</option>
                                    <option value="6">6ì›”</option>
                                    <option value="7">7ì›”</option>
                                    <option value="8">8ì›”</option>
                                    <option value="9">9ì›”</option>
                                    <option value="10">10ì›”</option>
                                    <option value="11">11ì›”</option>
                                    <option value="12">12ì›”</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>ì¼</label>
                                <input type="number" id="budgetDay" min="1" max="31">
                            </div>
                            <div class="form-group">
                                <label>ì‚¬ì—…ëª…</label>
                                <select id="budgetProgram" onchange="app.updateBudgetActivities()">
                                    <option value="">ì„ íƒ</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>ì„¸ë¶€í™œë™</label>
                                <select id="budgetActivity" onchange="app.updateBudgetItems()">
                                    <option value="">ì„ íƒ</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>ì‚¬ìš©ë‚´ìš©(ì˜ˆì‚° í•­ëª©)</label>
                                <select id="budgetItem">
                                    <option value="">ì„ íƒ</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>ì‚¬ìš©ê¸ˆì•¡</label>
                                <input type="number" id="budgetAmount" min="0">
                            </div>
                        </div>
                        <div class="form-row">
                            <button class="btn" onclick="app.addBudgetData()">ì¶”ê°€</button>
                        </div>
                    </div>
                </div>

                <div class="summary-section">
                    <div class="section-title">ì˜ˆì‚° ì‚¬ìš© í˜„í™©</div>
                    <div id="budgetSummary"></div>

                    <div class="section-title" style="margin-top: 30px;">ì›”ë³„ ì˜ˆì‚° ì‚¬ìš© í˜„í™©</div>
                    <div id="monthlyBudget"></div>

                    <div class="section-title" style="margin-top: 30px;">ë¶„ê¸°ë³„ ì˜ˆì‚° ì‚¬ìš© í˜„í™©</div>
                    <div id="quarterlyBudget"></div>
                </div>
            </div>

            <div class="log-section">
                <div class="section-title">ì…ë ¥ëœ ì˜ˆì‚° ì‚¬ìš© ë¡œê·¸</div>
                <table class="log-table">
                    <thead>
                        <tr>
                            <th>ì›”</th>
                            <th>ì¼</th>
                            <th>ì‚¬ì—…ëª…</th>
                            <th>ì„¸ë¶€í™œë™</th>
                            <th>ì‚¬ìš©ë‚´ìš©</th>
                            <th>ì‚¬ìš©ê¸ˆì•¡</th>
                            <th>ìˆ˜ì •</th>
                            <th>ì‚­ì œ</th>
                        </tr>
                    </thead>
                    <tbody id="budgetLog">
                    </tbody>
                </table>
            </div>
        </div>

        <div id="settings" class="tab-content">
            <div class="main-layout">
                <div class="input-section">
                    <div class="section-title">ì‚¬ì—… ê³„íš ì„¤ì •</div>

                    <div class="form-section">
                        <div class="form-section-title">ëª©í‘œ ì‹¤ì  ì…ë ¥</div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>ì‚¬ì—…ëª…</label>
                                <input type="text" id="targetProgram">
                            </div>
                            <div class="form-group">
                                <label>ì„¸ë¶€í™œë™ëª…</label>
                                <input type="text" id="targetActivity">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>ëª©í‘œ íšŒê¸°ìˆ˜</label>
                                <input type="number" id="targetSessions" min="0">
                            </div>
                            <div class="form-group">
                                <label>ëª©í‘œ ì¸ì›</label>
                                <input type="number" id="targetParticipants" min="0">
                            </div>
                        </div>
                        <div class="form-row">
                            <button class="btn" onclick="app.addTargetData()">ëª©í‘œ ì €ì¥</button>
                        </div>
                    </div>

                    <div class="form-section">
                        <div class="form-section-title">ëª©í‘œ ì˜ˆì‚° ì…ë ¥</div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>ì‚¬ì—…ëª…</label>
                                <input type="text" id="budgetProgramInput">
                            </div>
                            <div class="form-group">
                                <label>ì„¸ë¶€í™œë™ëª…</label>
                                <input type="text" id="budgetActivityInput">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>ì˜ˆì‚° í•­ëª©</label>
                                <input type="text" id="budgetItemInput">
                            </div>
                            <div class="form-group">
                                <label>ì˜ˆì‚°</label>
                                <input type="number" id="budgetAmountInput" min="0">
                            </div>
                        </div>
                        <div class="form-row">
                            <button class="btn" onclick="app.addBudgetPlan()">ì˜ˆì‚° ì €ì¥</button>
                        </div>
                    </div>

                    <div class="form-section">
                        <div class="form-section-title">ë°ì´í„° ë°±ì—… ë° ë³µì›</div>
                        <div class="form-row">
                            <button class="btn" onclick="app.exportToCSV()">ğŸ“¤ CSVë¡œ ë‚´ë³´ë‚´ê¸°</button>
                            <button class="btn" onclick="app.importFromCSV()">ğŸ“¥ CSVì—ì„œ ê°€ì ¸ì˜¤ê¸°</button>
                        </div>
                        <div class="form-row" style="margin-top: 10px;">
                            <button class="btn" onclick="app.exportToGoogleSheets()" id="googleExportBtn">ğŸ“¤ êµ¬ê¸€ ì‹œíŠ¸ë¡œ ë‚´ë³´ë‚´ê¸°</button>
                            <button class="btn" onclick="app.importFromGoogleSheets()" id="googleImportBtn">ğŸ“¥ êµ¬ê¸€ ì‹œíŠ¸ì—ì„œ ê°€ì ¸ì˜¤ê¸°</button>
                        </div>
                        <input type="file" id="csvFileInput" accept=".csv" style="display: none;" onchange="app.handleCSVFile(event)">
                    </div>

                    <table class="data-table">
                        <thead>
                            <tr>
                                <th colspan="5" style="background: #4facfe; color: white;">ëª©í‘œ ì‹¤ì  ë¡œê·¸</th>
                            </tr>
                            <tr>
                                <th>ì‚¬ì—…ëª…</th>
                                <th>ì„¸ë¶€í™œë™ëª…</th>
                                <th>ëª©í‘œ íšŒê¸°ìˆ˜</th>
                                <th>ëª©í‘œ ì¸ì›</th>
                                <th>ìˆ˜ì •/ì‚­ì œ</th>
                            </tr>
                        </thead>
                        <tbody id="targetLog">
                        </tbody>
                    </table>

                    <table class="data-table" style="margin-top: 20px;">
                        <thead>
                            <tr>
                                <th colspan="5" style="background: #4facfe; color: white;">ì˜ˆì‚° ê³„íš ë¡œê·¸</th>
                            </tr>
                            <tr>
                                <th>ì‚¬ì—…ëª…</th>
                                <th>ì„¸ë¶€í™œë™ëª…</th>
                                <th>ì˜ˆì‚° í•­ëª©</th>
                                <th>ì˜ˆì‚°</th>
                                <th>ìˆ˜ì •/ì‚­ì œ</th>
                            </tr>
                        </thead>
                        <tbody id="budgetPlanLog">
                        </tbody>
                    </table>
                </div>

                <div class="summary-section">
                    <div class="section-title">ì„¤ì •ëœ ì‚¬ì—… ê³„íš ìš”ì•½</div>
                    <div id="targetSummary"></div>
                    <div id="budgetPlanSummary"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ì•± ê°ì²´ë¡œ ëª¨ë“  ê¸°ëŠ¥ì„ ë¬¶ì–´ì„œ ê´€ë¦¬
        const app = {
            // ë°ì´í„° ì €ì¥ì†Œ
            targetData: [],
            budgetPlanData: [],
            performanceData: [],
            budgetData: [],

            // íƒ­ ì „í™˜ í•¨ìˆ˜ - ìˆ˜ì •ëœ ë²„ì „
            switchTab: function(tabName, element) {
                document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

                element.classList.add('active');
                document.getElementById(tabName).classList.add('active');

                // íƒ­ ì „í™˜ ì‹œ ëª¨ë“  ë°ì´í„°ë¥¼ ìµœì‹  ìƒíƒœë¡œ ì—…ë°ì´íŠ¸
                this.updateAllTables();
                this.refreshAllTabData();
            },

            // ì €ì¥ ê¸°ëŠ¥
            saveAllData: function() {
                try {
                    this.showSaveStatus();
                    console.log('ë°ì´í„°ê°€ ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
                } catch (error) {
                    console.error('ë°ì´í„° ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤:', error);
                    alert('ë°ì´í„° ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                }
            },

            showSaveStatus: function() {
                const saveStatus = document.getElementById('saveStatus');
                saveStatus.style.display = 'block';
                setTimeout(() => {
                    saveStatus.style.display = 'none';
                }, 2000);
            },

            autoSave: function() {
                this.saveAllData();
            },

            // ëª©í‘œ ë°ì´í„° ì¶”ê°€ - ìˆ˜ì •ëœ ë²„ì „
            addTargetData: function() {
                const program = document.getElementById('targetProgram').value.trim();
                const activity = document.getElementById('targetActivity').value.trim();
                const sessions = parseInt(document.getElementById('targetSessions').value) || 0;
                const participants = parseInt(document.getElementById('targetParticipants').value) || 0;

                if (!program || !activity) {
                    alert('ì‚¬ì—…ëª…ê³¼ ì„¸ë¶€í™œë™ëª…ì€ í•„ìˆ˜ì…ë‹ˆë‹¤.');
                    return;
                }

                const existingIndex = this.targetData.findIndex(item =>
                    item.program === program && item.activity === activity
                );

                if (existingIndex !== -1) {
                    this.targetData[existingIndex].sessions = sessions;
                    this.targetData[existingIndex].participants = participants;
                } else {
                    this.targetData.push({
                        id: Date.now(),
                        program,
                        activity,
                        sessions,
                        participants
                    });
                }

                this.clearTargetForm();
                this.updateAllTables();
                // ë‹¤ë¥¸ íƒ­ë“¤ë„ ì¦‰ì‹œ ì—…ë°ì´íŠ¸
                this.refreshAllTabData();
                this.autoSave();
            },

            // ì˜ˆì‚° ê³„íš ì¶”ê°€ - ìˆ˜ì •ëœ ë²„ì „
            addBudgetPlan: function() {
                const program = document.getElementById('budgetProgramInput').value.trim();
                const activity = document.getElementById('budgetActivityInput').value.trim();
                const item = document.getElementById('budgetItemInput').value.trim();
                const amount = parseInt(document.getElementById('budgetAmountInput').value) || 0;

                if (!program || !activity || !item) {
                    alert('ì‚¬ì—…ëª…, ì„¸ë¶€í™œë™ëª…, ì˜ˆì‚° í•­ëª©ì€ í•„ìˆ˜ì…ë‹ˆë‹¤.');
                    return;
                }

                this.budgetPlanData.push({
                    id: Date.now(),
                    program,
                    activity,
                    item,
                    amount
                });

                this.clearBudgetPlanForm();
                this.updateAllTables();
                // ë‹¤ë¥¸ íƒ­ë“¤ë„ ì¦‰ì‹œ ì—…ë°ì´íŠ¸
                this.refreshAllTabData();
                this.autoSave();
            },

            // ëª¨ë“  íƒ­ ë°ì´í„° ìƒˆë¡œê³ ì¹¨
            refreshAllTabData: function() {
                // í˜„ì¬ í™œì„±í™”ëœ íƒ­ê³¼ ìƒê´€ì—†ì´ ëª¨ë“  íƒ­ì˜ ë°ì´í„°ë¥¼ ì—…ë°ì´íŠ¸
                this.updatePerformanceSummary();
                this.updateMonthlyPerformance();
                this.updateQuarterlyPerformance();
                this.updateBudgetSummary();
                this.updateMonthlyBudget();
                this.updateQuarterlyBudget();
                this.updateTargetSummary();
                this.updateBudgetPlanSummary();
                console.log('ëª¨ë“  íƒ­ ë°ì´í„°ê°€ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤.');
            },

            // ì‹¤ì  ë°ì´í„° ì¶”ê°€
            addPerformanceData: function() {
                const month = parseInt(document.getElementById('month').value);
                const day = parseInt(document.getElementById('day').value);
                const program = document.getElementById('program').value;
                const activity = document.getElementById('activity').value;
                const recipients = parseInt(document.getElementById('recipientCount').value) || 0;
                const general = parseInt(document.getElementById('generalCount').value) || 0;

                if (!month || !day || !program || !activity) {
                    alert('ëª¨ë“  í•„ìˆ˜ í•­ëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    return;
                }

                this.performanceData.push({
                    id: Date.now(),
                    month,
                    day,
                    program,
                    activity,
                    recipients,
                    general,
                    total: recipients + general
                });

                this.clearPerformanceForm();
                this.updateAllTables();
                this.autoSave();
            },

            // ì˜ˆì‚° ì‚¬ìš© ë°ì´í„° ì¶”ê°€
            addBudgetData: function() {
                const month = parseInt(document.getElementById('budgetMonth').value);
                const day = parseInt(document.getElementById('budgetDay').value);
                const program = document.getElementById('budgetProgram').value;
                const activity = document.getElementById('budgetActivity').value;
                const item = document.getElementById('budgetItem').value;
                const amount = parseInt(document.getElementById('budgetAmount').value) || 0;

                if (!month || !day || !program || !activity || !item) {
                    alert('ëª¨ë“  í•„ìˆ˜ í•­ëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    return;
                }

                this.budgetData.push({
                    id: Date.now(),
                    month,
                    day,
                    program,
                    activity,
                    item,
                    amount
                });

                this.clearBudgetForm();
                this.updateAllTables();
                this.autoSave();
            },

            // í¼ ì´ˆê¸°í™” í•¨ìˆ˜ë“¤
            clearTargetForm: function() {
                document.getElementById('targetProgram').value = '';
                document.getElementById('targetActivity').value = '';
                document.getElementById('targetSessions').value = '';
                document.getElementById('targetParticipants').value = '';
            },

            clearBudgetPlanForm: function() {
                document.getElementById('budgetProgramInput').value = '';
                document.getElementById('budgetActivityInput').value = '';
                document.getElementById('budgetItemInput').value = '';
                document.getElementById('budgetAmountInput').value = '';
            },

            clearPerformanceForm: function() {
                document.getElementById('month').value = '';
                document.getElementById('day').value = '';
                document.getElementById('program').value = '';
                document.getElementById('activity').innerHTML = '<option value="">ì„ íƒ</option>';
                document.getElementById('recipientCount').value = '0';
                document.getElementById('generalCount').value = '0';
            },

            clearBudgetForm: function() {
                document.getElementById('budgetMonth').value = '';
                document.getElementById('budgetDay').value = '';
                document.getElementById('budgetProgram').value = '';
                document.getElementById('budgetActivity').innerHTML = '<option value="">ì„ íƒ</option>';
                document.getElementById('budgetItem').innerHTML = '<option value="">ì„ íƒ</option>';
                document.getElementById('budgetAmount').value = '';
            },

            // í”„ë¡œê·¸ë¨ ì„ íƒ ì˜µì…˜ ì—…ë°ì´íŠ¸
            updateProgramSelects: function() {
                const programs = [...new Set([...this.targetData, ...this.budgetPlanData].map(item => item.program))];

                const programSelect = document.getElementById('program');
                const budgetProgramSelect = document.getElementById('budgetProgram');

                programSelect.innerHTML = '<option value="">ì„ íƒ</option>';
                budgetProgramSelect.innerHTML = '<option value="">ì„ íƒ</option>';

                programs.forEach(program => {
                    programSelect.innerHTML += `<option value="${program}">${program}</option>`;
                    budgetProgramSelect.innerHTML += `<option value="${program}">${program}</option>`;
                });
            },

            // í™œë™ ì˜µì…˜ ì—…ë°ì´íŠ¸
            updateActivities: function() {
                const selectedProgram = document.getElementById('program').value;
                const activitySelect = document.getElementById('activity');

                activitySelect.innerHTML = '<option value="">ì„ íƒ</option>';

                if (selectedProgram) {
                    const activities = [...new Set([...this.targetData, ...this.budgetPlanData]
                        .filter(item => item.program === selectedProgram)
                        .map(item => item.activity))];

                    activities.forEach(activity => {
                        activitySelect.innerHTML += `<option value="${activity}">${activity}</option>`;
                    });
                }
            },

            updateBudgetActivities: function() {
                const selectedProgram = document.getElementById('budgetProgram').value;
                const activitySelect = document.getElementById('budgetActivity');

                activitySelect.innerHTML = '<option value="">ì„ íƒ</option>';

                if (selectedProgram) {
                    const activities = [...new Set(this.budgetPlanData
                        .filter(item => item.program === selectedProgram)
                        .map(item => item.activity))];

                    activities.forEach(activity => {
                        activitySelect.innerHTML += `<option value="${activity}">${activity}</option>`;
                    });
                }
            },

            updateBudgetItems: function() {
                const selectedProgram = document.getElementById('budgetProgram').value;
                const selectedActivity = document.getElementById('budgetActivity').value;
                const itemSelect = document.getElementById('budgetItem');

                itemSelect.innerHTML = '<option value="">ì„ íƒ</option>';

                if (selectedProgram && selectedActivity) {
                    const items = this.budgetPlanData
                        .filter(item => item.program === selectedProgram && item.activity === selectedActivity)
                        .map(item => item.item);

                    items.forEach(item => {
                        itemSelect.innerHTML += `<option value="${item}">${item}</option>`;
                    });
                }
            },

            // ëª¨ë“  í…Œì´ë¸” ì—…ë°ì´íŠ¸
            updateAllTables: function() {
                this.updateProgramSelects();
                this.updateTargetLog();
                this.updateBudgetPlanLog();
                this.updateTargetSummary();
                this.updateBudgetPlanSummary();
                this.updatePerformanceSummary();
                this.updateMonthlyPerformance();
                this.updateQuarterlyPerformance();
                this.updateBudgetSummary();
                this.updateMonthlyBudget();
                this.updateQuarterlyBudget();
                this.updatePerformanceLog();
                this.updateBudgetLog();
            },

            // ëª©í‘œ ë¡œê·¸ ì—…ë°ì´íŠ¸
            updateTargetLog: function() {
                const tbody = document.getElementById('targetLog');
                tbody.innerHTML = '';

                this.targetData.forEach(item => {
                    tbody.innerHTML += `
                        <tr>
                            <td>${item.program}</td>
                            <td>${item.activity}</td>
                            <td>${item.sessions}</td>
                            <td>${item.participants}</td>
                            <td>
                                <button class="btn-edit" onclick="app.editTarget(${item.id})">ìˆ˜ì •</button>
                                <button class="delete-btn" onclick="app.deleteTarget(${item.id})">ì‚­ì œ</button>
                            </td>
                        </tr>
                    `;
                });
            },

            // ì˜ˆì‚° ê³„íš ë¡œê·¸ ì—…ë°ì´íŠ¸
            updateBudgetPlanLog: function() {
                const tbody = document.getElementById('budgetPlanLog');
                tbody.innerHTML = '';

                this.budgetPlanData.forEach(item => {
                    tbody.innerHTML += `
                        <tr>
                            <td>${item.program}</td>
                            <td>${item.activity}</td>
                            <td>${item.item}</td>
                            <td>${item.amount.toLocaleString()}ì›</td>
                            <td>
                                <button class="btn-edit" onclick="app.editBudgetPlan(${item.id})">ìˆ˜ì •</button>
                                <button class="delete-btn" onclick="app.deleteBudgetPlan(${item.id})">ì‚­ì œ</button>
                            </td>
                        </tr>
                    `;
                });
            },

            // ëª©í‘œ ìš”ì•½ ì—…ë°ì´íŠ¸
            updateTargetSummary: function() {
                const div = document.getElementById('targetSummary');
                if (!this.targetData.length) {
                    div.innerHTML = '';
                    return;
                }

                const programs = [...new Set(this.targetData.map(item => item.program))];
                let html = '<div class="form-section-title" style="margin-bottom: 15px;">ëª©í‘œ ì‹¤ì  ê³„íš</div>';

                programs.forEach(program => {
                    const programData = this.targetData.filter(item => item.program === program);
                    let totalSessions = 0;
                    let totalParticipants = 0;

                    html += `
                        <table class="summary-table">
                            <thead>
                                <tr class="program-header">
                                    <th colspan="4">${program}</th>
                                </tr>
                                <tr>
                                    <th>ì„¸ë¶€í™œë™</th>
                                    <th>ëª©í‘œ íšŒê¸°ìˆ˜</th>
                                    <th>ëª©í‘œ ì¸ì›</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody>
                    `;

                    programData.forEach(item => {
                        totalSessions += item.sessions;
                        totalParticipants += item.participants;
                        html += `
                            <tr>
                                <td>${item.activity}</td>
                                <td>${item.sessions}</td>
                                <td>${item.participants}</td>
                                <td></td>
                            </tr>
                        `;
                    });

                    html += `
                            <tr class="total-row">
                                <td>ì´ ê³„</td>
                                <td>${totalSessions}</td>
                                <td>${totalParticipants}</td>
                                <td></td>
                            </tr>
                        </tbody>
                    </table>
                    `;
                });

                div.innerHTML = html;
            },

            // ì˜ˆì‚° ê³„íš ìš”ì•½ ì—…ë°ì´íŠ¸
            updateBudgetPlanSummary: function() {
                const div = document.getElementById('budgetPlanSummary');
                if (!this.budgetPlanData.length) {
                    div.innerHTML = '';
                    return;
                }

                const programs = [...new Set(this.budgetPlanData.map(item => item.program))];
                let html = '<div class="form-section-title" style="margin-bottom: 15px;">ì˜ˆì‚° ê³„íš</div>';

                programs.forEach(program => {
                    const programData = this.budgetPlanData.filter(item => item.program === program);
                    const activities = [...new Set(programData.map(item => item.activity))];
                    let totalBudget = 0;

                    html += `
                        <table class="summary-table">
                            <thead>
                                <tr class="program-header">
                                    <th colspan="4">${program}</th>
                                </tr>
                                <tr>
                                    <th>ì„¸ë¶€í™œë™</th>
                                    <th>ì˜ˆì‚° í•­ëª©</th>
                                    <th>ì˜ˆì‚°</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody>
                    `;

                    activities.forEach(activity => {
                        const activityData = programData.filter(item => item.activity === activity);
                        activityData.forEach((item, index) => {
                            totalBudget += item.amount;
                            html += `
                                <tr>
                                    ${index === 0 ? `<td rowspan="${activityData.length}">${activity}</td>` : ''}
                                    <td>${item.item}</td>
                                    <td>${item.amount.toLocaleString()}ì›</td>
                                    <td></td>
                                </tr>
                            `;
                        });
                    });

                    html += `
                            <tr class="total-row">
                                <td colspan="2">ì´ ì˜ˆì‚°</td>
                                <td>${totalBudget.toLocaleString()}ì›</td>
                                <td></td>
                            </tr>
                        </tbody>
                    </table>
                    `;
                });

                div.innerHTML = html;
            },

            // ì‹¤ì  ìš”ì•½ ì—…ë°ì´íŠ¸
            updatePerformanceSummary: function() {
                const div = document.getElementById('performanceSummary');
                if (!this.performanceData.length) {
                    div.innerHTML = '';
                    return;
                }

                const programs = [...new Set(this.performanceData.map(item => item.program))];
                let html = '';

                programs.forEach(program => {
                    const programPerformance = this.performanceData.filter(item => item.program === program);
                    const activities = [...new Set(programPerformance.map(item => item.activity))];

                    html += `
                        <table class="summary-table">
                            <thead>
                                <tr class="program-header">
                                    <th colspan="8">${program}</th>
                                </tr>
                                <tr>
                                    <th rowspan="2">í™œë™ëª…</th>
                                    <th rowspan="2">ëª©í‘œ íšŒê¸°ìˆ˜</th>
                                    <th rowspan="2">ì‹¤ì œ íšŒê¸°ìˆ˜</th>
                                    <th rowspan="2">ëª©í‘œ ì¸ì›</th>
                                    <th colspan="3">ì‹¤ì œ ì¸ì›</th>
                                    <th rowspan="2">ë‹¬ì„±ë¥ </th>
                                </tr>
                                <tr>
                                    <th>ì´í•©</th>
                                    <th>ìˆ˜ê¸‰</th>
                                    <th>ì¼ë°˜</th>
                                </tr>
                            </thead>
                            <tbody>
                    `;

                    let totalTargetSessions = 0;
                    let totalActualSessions = 0;
                    let totalTargetParticipants = 0;
                    let totalActualParticipants = 0;
                    let totalRecipients = 0;
                    let totalGeneral = 0;

                    activities.forEach(activity => {
                        const activityPerformance = programPerformance.filter(item => item.activity === activity);
                        const actualSessions = activityPerformance.length;
                        const actualParticipants = activityPerformance.reduce((sum, item) => sum + item.total, 0);
                        const recipients = activityPerformance.reduce((sum, item) => sum + item.recipients, 0);
                        const general = activityPerformance.reduce((sum, item) => sum + item.general, 0);

                        // í˜„ì¬ ëª©í‘œ ë°ì´í„°ì—ì„œ ìµœì‹  ê°’ì„ ê°€ì ¸ì˜´
                        const targetItem = this.targetData.find(item => item.program === program && item.activity === activity);
                        const targetSessions = targetItem ? targetItem.sessions : 0;
                        const targetParticipants = targetItem ? targetItem.participants : 0;

                        // ë‹¬ì„±ë¥ ì„ íšŒê¸°ìˆ˜ì™€ ì¸ì› ëª¨ë‘ ê³ ë ¤í•˜ì—¬ ê³„ì‚°
                        let achievementRate = 0;
                        if (targetSessions > 0 && targetParticipants > 0) {
                            const sessionRate = (actualSessions / targetSessions) * 100;
                            const participantRate = targetParticipants > 0 ? (actualParticipants / targetParticipants) * 100 : 0;
                            // íšŒê¸°ìˆ˜ì™€ ì¸ì› ë‹¬ì„±ë¥ ì˜ í‰ê·  (ë˜ëŠ” ë” ì ì ˆí•œ ê°€ì¤‘ì¹˜ ì ìš© ê°€ëŠ¥)
                            achievementRate = ((sessionRate + participantRate) / 2).toFixed(1);
                        } else if (targetSessions > 0) {
                            achievementRate = ((actualSessions / targetSessions) * 100).toFixed(1);
                        } else if (actualSessions > 0) {
                            achievementRate = '100.0';
                        }

                        totalTargetSessions += targetSessions;
                        totalActualSessions += actualSessions;
                        totalTargetParticipants += targetParticipants;
                        totalActualParticipants += actualParticipants;
                        totalRecipients += recipients;
                        totalGeneral += general;

                        html += `
                            <tr>
                                <td>${activity}</td>
                                <td>${targetSessions}</td>
                                <td>${actualSessions}</td>
                                <td>${targetParticipants}</td>
                                <td>${actualParticipants}</td>
                                <td>${recipients}</td>
                                <td>${general}</td>
                                <td>${achievementRate}%</td>
                            </tr>
                        `;
                    });

                    // ì „ì²´ ë‹¬ì„±ë¥  ê³„ì‚°
                    let overallAchievementRate = 0;
                    if (totalTargetSessions > 0 && totalTargetParticipants > 0) {
                        const sessionRate = (totalActualSessions / totalTargetSessions) * 100;
                        const participantRate = (totalActualParticipants / totalTargetParticipants) * 100;
                        overallAchievementRate = ((sessionRate + participantRate) / 2).toFixed(1);
                    } else if (totalTargetSessions > 0) {
                        overallAchievementRate = ((totalActualSessions / totalTargetSessions) * 100).toFixed(1);
                    } else if (totalActualSessions > 0) {
                        overallAchievementRate = '100.0';
                    }

                    html += `
                            <tr class="total-row">
                                <td>í•©ê³„</td>
                                <td>${totalTargetSessions}</td>
                                <td>${totalActualSessions}</td>
                                <td>${totalTargetParticipants}</td>
                                <td>${totalActualParticipants}</td>
                                <td>${totalRecipients}</td>
                                <td>${totalGeneral}</td>
                                <td>${overallAchievementRate}%</td>
                            </tr>
                        </tbody>
                    </table>
                    `;
                });

                div.innerHTML = html;
            },

            // ì›”ë³„ ì‹¤ì  ì—…ë°ì´íŠ¸
            updateMonthlyPerformance: function() {
                const div = document.getElementById('monthlyPerformance');
                if (!this.performanceData.length) {
                    div.innerHTML = '';
                    return;
                }

                const programs = [...new Set(this.performanceData.map(item => item.program))];
                let html = '';

                programs.forEach(program => {
                    const monthlyData = Array(12).fill(0).map(() => ({ sessions: 0, recipients: 0, general: 0, total: 0 }));
                    let yearTotal = { sessions: 0, recipients: 0, general: 0, total: 0 };

                    this.performanceData.filter(item => item.program === program).forEach(item => {
                        const monthIndex = item.month - 1;
                        monthlyData[monthIndex].sessions += 1;
                        monthlyData[monthIndex].recipients += item.recipients;
                        monthlyData[monthIndex].general += item.general;
                        monthlyData[monthIndex].total += item.total;
                    });

                    monthlyData.forEach(month => {
                        yearTotal.sessions += month.sessions;
                        yearTotal.recipients += month.recipients;
                        yearTotal.general += month.general;
                        yearTotal.total += month.total;
                    });

                    html += `
                        <table class="summary-table">
                            <thead>
                                <tr class="program-header">
                                    <th colspan="14">${program}</th>
                                </tr>
                                <tr>
                                    <th>êµ¬ë¶„</th>
                                    <th>1ì›”</th>
                                    <th>2ì›”</th>
                                    <th>3ì›”</th>
                                    <th>4ì›”</th>
                                    <th>5ì›”</th>
                                    <th>6ì›”</th>
                                    <th>7ì›”</th>
                                    <th>8ì›”</th>
                                    <th>9ì›”</th>
                                    <th>10ì›”</th>
                                    <th>11ì›”</th>
                                    <th>12ì›”</th>
                                    <th>í•©ê³„</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>íšŒê¸°ìˆ˜</td>
                                    ${monthlyData.map(month => `<td>${month.sessions}</td>`).join('')}
                                    <td>${yearTotal.sessions}</td>
                                </tr>
                                <tr>
                                    <td>ìˆ˜ê¸‰ì</td>
                                    ${monthlyData.map(month => `<td>${month.recipients}</td>`).join('')}
                                    <td>${yearTotal.recipients}</td>
                                </tr>
                                <tr>
                                    <td>ì¼ë°˜</td>
                                    ${monthlyData.map(month => `<td>${month.general}</td>`).join('')}
                                    <td>${yearTotal.general}</td>
                                </tr>
                                <tr class="total-row">
                                    <td>ì´ ì¸ì›</td>
                                    ${monthlyData.map(month => `<td>${month.total}</td>`).join('')}
                                    <td>${yearTotal.total}</td>
                                </tr>
                            </tbody>
                        </table>
                    `;
                });

                div.innerHTML = html;
            },

            // ë¶„ê¸°ë³„ ì‹¤ì  ì—…ë°ì´íŠ¸
            updateQuarterlyPerformance: function() {
                const div = document.getElementById('quarterlyPerformance');
                if (!this.performanceData.length) {
                    div.innerHTML = '';
                    return;
                }

                const programs = [...new Set(this.performanceData.map(item => item.program))];
                let html = '';

                programs.forEach(program => {
                    const quarterlyData = Array(4).fill(0).map(() => ({ sessions: 0, recipients: 0, general: 0, total: 0 }));
                    let yearTotal = { sessions: 0, recipients: 0, general: 0, total: 0 };

                    this.performanceData.filter(item => item.program === program).forEach(item => {
                        const quarterIndex = Math.floor((item.month - 1) / 3);
                        quarterlyData[quarterIndex].sessions += 1;
                        quarterlyData[quarterIndex].recipients += item.recipients;
                        quarterlyData[quarterIndex].general += item.general;
                        quarterlyData[quarterIndex].total += item.total;
                    });

                    quarterlyData.forEach(quarter => {
                        yearTotal.sessions += quarter.sessions;
                        yearTotal.recipients += quarter.recipients;
                        yearTotal.general += quarter.general;
                        yearTotal.total += quarter.total;
                    });

                    html += `
                        <table class="summary-table">
                            <thead>
                                <tr class="program-header">
                                    <th colspan="6">${program}</th>
                                </tr>
                                <tr>
                                    <th>êµ¬ë¶„</th>
                                    <th>1ë¶„ê¸°</th>
                                    <th>2ë¶„ê¸°</th>
                                    <th>3ë¶„ê¸°</th>
                                    <th>4ë¶„ê¸°</th>
                                    <th>í•©ê³„</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>íšŒê¸°ìˆ˜</td>
                                    ${quarterlyData.map(quarter => `<td>${quarter.sessions}</td>`).join('')}
                                    <td>${yearTotal.sessions}</td>
                                </tr>
                                <tr>
                                    <td>ìˆ˜ê¸‰ì</td>
                                    ${quarterlyData.map(quarter => `<td>${quarter.recipients}</td>`).join('')}
                                    <td>${yearTotal.recipients}</td>
                                </tr>
                                <tr>
                                    <td>ì¼ë°˜</td>
                                    ${quarterlyData.map(quarter => `<td>${quarter.general}</td>`).join('')}
                                    <td>${yearTotal.general}</td>
                                </tr>
                                <tr class="total-row">
                                    <td>ì´ ì¸ì›</td>
                                    ${quarterlyData.map(quarter => `<td>${quarter.total}</td>`).join('')}
                                    <td>${yearTotal.total}</td>
                                </tr>
                            </tbody>
                        </table>
                    `;
                });

                div.innerHTML = html;
            },

            // ì˜ˆì‚° ì‚¬ìš© í˜„í™© ì—…ë°ì´íŠ¸
            updateBudgetSummary: function() {
                const div = document.getElementById('budgetSummary');
                if (!this.budgetPlanData.length) {
                    div.innerHTML = '';
                    return;
                }

                const programs = [...new Set(this.budgetPlanData.map(item => item.program))];
                let html = '';

                programs.forEach(program => {
                    const programBudgetPlan = this.budgetPlanData.filter(item => item.program === program);
                    const activities = [...new Set(programBudgetPlan.map(item => item.activity))];

                    html += `
                        <table class="summary-table">
                            <thead>
                                <tr class="program-header">
                                    <th colspan="6">${program}</th>
                                </tr>
                                <tr>
                                    <th>ì„¸ë¶€í™œë™</th>
                                    <th>ì˜ˆì‚° í•­ëª©</th>
                                    <th>ì˜ˆì‚°</th>
                                    <th>ì‚¬ìš©ê¸ˆì•¡</th>
                                    <th>ì”ì—¬ ì˜ˆì‚°</th>
                                    <th>ì‚¬ìš©ë¥ </th>
                                </tr>
                            </thead>
                            <tbody>
                    `;

                    let programTotalPlanned = 0;
                    let programTotalUsed = 0;

                    activities.forEach(activity => {
                        const activityBudgetPlan = programBudgetPlan.filter(item => item.activity === activity);
                        activityBudgetPlan.forEach((planItem, index) => {
                            // í˜„ì¬ ì˜ˆì‚° ì‚¬ìš© ë°ì´í„°ì—ì„œ ìµœì‹  ì‚¬ìš©ê¸ˆì•¡ì„ ê³„ì‚°
                            const usedAmount = this.budgetData
                                .filter(item => item.program === program && item.activity === activity && item.item === planItem.item)
                                .reduce((sum, item) => sum + item.amount, 0);

                            const remainingAmount = planItem.amount - usedAmount;
                            const usageRate = planItem.amount > 0 ? ((usedAmount / planItem.amount) * 100).toFixed(1) : 0;

                            programTotalPlanned += planItem.amount;
                            programTotalUsed += usedAmount;

                            html += `
                                <tr>
                                    ${index === 0 ? `<td rowspan="${activityBudgetPlan.length}">${activity}</td>` : ''}
                                    <td>${planItem.item}</td>
                                    <td>${planItem.amount.toLocaleString()}ì›</td>
                                    <td>${usedAmount.toLocaleString()}ì›</td>
                                    <td>${remainingAmount.toLocaleString()}ì›</td>
                                    <td>${usageRate}%</td>
                                </tr>
                            `;
                        });
                    });

                    const programRemainingBudget = programTotalPlanned - programTotalUsed;
                    const programUsageRate = programTotalPlanned > 0 ?
                        ((programTotalUsed / programTotalPlanned) * 100).toFixed(1) : 0;

                    html += `
                            <tr class="total-row">
                                <td colspan="2">í•©ê³„</td>
                                <td>${programTotalPlanned.toLocaleString()}ì›</td>
                                <td>${programTotalUsed.toLocaleString()}ì›</td>
                                <td>${programRemainingBudget.toLocaleString()}ì›</td>
                                <td>${programUsageRate}%</td>
                            </tr>
                        </tbody>
                    </table>
                    `;
                });

                div.innerHTML = html;
            },

            // ì›”ë³„ ì˜ˆì‚° ì‚¬ìš© í˜„í™© ì—…ë°ì´íŠ¸
            updateMonthlyBudget: function() {
                const div = document.getElementById('monthlyBudget');
                if (!this.budgetData.length) {
                    div.innerHTML = '';
                    return;
                }

                const programs = [...new Set(this.budgetData.map(item => item.program))];
                let html = '';

                programs.forEach(program => {
                    const monthlyData = Array(12).fill(0);
                    let yearTotal = 0;

                    this.budgetData.filter(item => item.program === program).forEach(item => {
                        const monthIndex = item.month - 1;
                        monthlyData[monthIndex] += item.amount;
                    });

                    yearTotal = monthlyData.reduce((sum, amount) => sum + amount, 0);

                    html += `
                        <table class="summary-table">
                            <thead>
                                <tr class="program-header">
                                    <th colspan="14">${program}</th>
                                </tr>
                                <tr>
                                    <th>ì›”</th>
                                    <th>1ì›”</th>
                                    <th>2ì›”</th>
                                    <th>3ì›”</th>
                                    <th>4ì›”</th>
                                    <th>5ì›”</th>
                                    <th>6ì›”</th>
                                    <th>7ì›”</th>
                                    <th>8ì›”</th>
                                    <th>9ì›”</th>
                                    <th>10ì›”</th>
                                    <th>11ì›”</th>
                                    <th>12ì›”</th>
                                    <th>í•©ê³„</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>ì‚¬ìš©ê¸ˆì•¡</td>
                                    ${monthlyData.map(amount => `<td>${amount.toLocaleString()}ì›</td>`).join('')}
                                    <td>${yearTotal.toLocaleString()}ì›</td>
                                </tr>
                            </tbody>
                        </table>
                    `;
                });

                div.innerHTML = html;
            },

            // ë¶„ê¸°ë³„ ì˜ˆì‚° ì‚¬ìš© í˜„í™© ì—…ë°ì´íŠ¸
            updateQuarterlyBudget: function() {
                const div = document.getElementById('quarterlyBudget');
                if (!this.budgetData.length) {
                    div.innerHTML = '';
                    return;
                }

                const programs = [...new Set(this.budgetData.map(item => item.program))];
                let html = '';

                programs.forEach(program => {
                    const quarterlyData = Array(4).fill(0);
                    let yearTotal = 0;

                    this.budgetData.filter(item => item.program === program).forEach(item => {
                        const quarterIndex = Math.floor((item.month - 1) / 3);
                        quarterlyData[quarterIndex] += item.amount;
                    });

                    yearTotal = quarterlyData.reduce((sum, amount) => sum + amount, 0);

                    html += `
                        <table class="summary-table">
                            <thead>
                                <tr class="program-header">
                                    <th colspan="6">${program}</th>
                                </tr>
                                <tr>
                                    <th>ë¶„ê¸°</th>
                                    <th>1ë¶„ê¸°</th>
                                    <th>2ë¶„ê¸°</th>
                                    <th>3ë¶„ê¸°</th>
                                    <th>4ë¶„ê¸°</th>
                                    <th>í•©ê³„</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>ì‚¬ìš©ê¸ˆì•¡</td>
                                    ${quarterlyData.map(amount => `<td>${amount.toLocaleString()}ì›</td>`).join('')}
                                    <td>${yearTotal.toLocaleString()}ì›</td>
                                </tr>
                            </tbody>
                        </table>
                    `;
                });

                div.innerHTML = html;
            },

            // ì‹¤ì  ë¡œê·¸ ì—…ë°ì´íŠ¸
            updatePerformanceLog: function() {
                const tbody = document.getElementById('performanceLog');
                tbody.innerHTML = '';

                this.performanceData.sort((a, b) => {
                    if (a.month !== b.month) return a.month - b.month;
                    return a.day - b.day;
                }).forEach(item => {
                    tbody.innerHTML += `
                        <tr>
                            <td>${item.month}</td>
                            <td>${item.day}</td>
                            <td>${item.program}</td>
                            <td>${item.activity}</td>
                            <td>${item.recipients}</td>
                            <td>${item.general}</td>
                            <td>${item.total}</td>
                            <td><button class="btn-edit" onclick="app.editPerformance(${item.id})">ìˆ˜ì •</button></td>
                            <td><button class="delete-btn" onclick="app.deletePerformance(${item.id})">ì‚­ì œ</button></td>
                        </tr>
                    `;
                });
            },

            // ì˜ˆì‚° ë¡œê·¸ ì—…ë°ì´íŠ¸
            updateBudgetLog: function() {
                const tbody = document.getElementById('budgetLog');
                tbody.innerHTML = '';

                this.budgetData.sort((a, b) => {
                    if (a.month !== b.month) return a.month - b.month;
                    return a.day - b.day;
                }).forEach(item => {
                    tbody.innerHTML += `
                        <tr>
                            <td>${item.month}</td>
                            <td>${item.day}</td>
                            <td>${item.program}</td>
                            <td>${item.activity}</td>
                            <td>${item.item}</td>
                            <td>${item.amount.toLocaleString()}ì›</td>
                            <td><button class="btn-edit" onclick="app.editBudget(${item.id})">ìˆ˜ì •</button></td>
                            <td><button class="delete-btn" onclick="app.deleteBudget(${item.id})">ì‚­ì œ</button></td>
                        </tr>
                    `;
                });
            },

            // í¸ì§‘ í•¨ìˆ˜ë“¤
            editTarget: function(id) {
                const item = this.targetData.find(item => item.id === id);
                if (item) {
                    document.getElementById('targetProgram').value = item.program;
                    document.getElementById('targetActivity').value = item.activity;
                    document.getElementById('targetSessions').value = item.sessions;
                    document.getElementById('targetParticipants').value = item.participants;
                    this.deleteTarget(id);
                }
            },

            editBudgetPlan: function(id) {
                const item = this.budgetPlanData.find(item => item.id === id);
                if (item) {
                    document.getElementById('budgetProgramInput').value = item.program;
                    document.getElementById('budgetActivityInput').value = item.activity;
                    document.getElementById('budgetItemInput').value = item.item;
                    document.getElementById('budgetAmountInput').value = item.amount;
                    this.deleteBudgetPlan(id);
                }
            },

            editPerformance: function(id) {
                const item = this.performanceData.find(item => item.id === id);
                if (item) {
                    document.getElementById('month').value = item.month;
                    document.getElementById('day').value = item.day;
                    document.getElementById('program').value = item.program;
                    this.updateActivities();
                    setTimeout(() => {
                        document.getElementById('activity').value = item.activity;
                    }, 100);
                    document.getElementById('recipientCount').value = item.recipients;
                    document.getElementById('generalCount').value = item.general;
                    this.deletePerformance(id);
                }
            },

            editBudget: function(id) {
                const item = this.budgetData.find(item => item.id === id);
                if (item) {
                    document.getElementById('budgetMonth').value = item.month;
                    document.getElementById('budgetDay').value = item.day;
                    document.getElementById('budgetProgram').value = item.program;
                    this.updateBudgetActivities();
                    setTimeout(() => {
                        document.getElementById('budgetActivity').value = item.activity;
                        this.updateBudgetItems();
                        setTimeout(() => {
                            document.getElementById('budgetItem').value = item.item;
                        }, 100);
                    }, 100);
                    document.getElementById('budgetAmount').value = item.amount;
                    this.deleteBudget(id);
                }
            },

            // ì‚­ì œ í•¨ìˆ˜ë“¤ - ìˆ˜ì •ëœ ë²„ì „
            deleteTarget: function(id) {
                this.targetData = this.targetData.filter(item => item.id !== id);
                this.updateAllTables();
                this.refreshAllTabData(); // ë‹¤ë¥¸ íƒ­ë“¤ë„ ì—…ë°ì´íŠ¸
                this.autoSave();
            },

            deleteBudgetPlan: function(id) {
                this.budgetPlanData = this.budgetPlanData.filter(item => item.id !== id);
                this.updateAllTables();
                this.refreshAllTabData(); // ë‹¤ë¥¸ íƒ­ë“¤ë„ ì—…ë°ì´íŠ¸
                this.autoSave();
            },

            deletePerformance: function(id) {
                this.performanceData = this.performanceData.filter(item => item.id !== id);
                this.updateAllTables();
                this.refreshAllTabData(); // ë‹¤ë¥¸ íƒ­ë“¤ë„ ì—…ë°ì´íŠ¸
                this.autoSave();
            },

            deleteBudget: function(id) {
                this.budgetData = this.budgetData.filter(item => item.id !== id);
                this.updateAllTables();
                this.refreshAllTabData(); // ë‹¤ë¥¸ íƒ­ë“¤ë„ ì—…ë°ì´íŠ¸
                this.autoSave();
            }
        };

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', () => {
            // ì €ì¥ëœ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
            app.loadAllData();
            // í…Œì´ë¸” ì—…ë°ì´íŠ¸
            app.updateAllTables();
        });

        // ë¸Œë¼ìš°ì € ì¢…ë£Œ ì‹œ ìë™ ì €ì¥
        window.addEventListener('beforeunload', function() {
            app.saveAllData();
        });
    </script>
</body>

</html>
